<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE book [
        <!-- Some useful entities borrowed from HTML -->
        <!ENTITY ndash  "&#x2013;">
        <!ENTITY mdash  "&#x2014;">
        <!ENTITY hellip "&#x2026;">

        <!-- Useful for describing APIs -->
        <!ENTITY GET    '<command xmlns="http://docbook.org/ns/docbook">GET</command>'>
        <!ENTITY PUT    '<command xmlns="http://docbook.org/ns/docbook">PUT</command>'>
        <!ENTITY POST   '<command xmlns="http://docbook.org/ns/docbook">POST</command>'>
        <!ENTITY DELETE '<command xmlns="http://docbook.org/ns/docbook">DELETE</command>'>

        <!-- Useful for specs -->
        <!ENTITY MAY    '<emphasis xmlns="http://docbook.org/ns/docbook" role="strong">MAY</emphasis>'>
        <!ENTITY SHOULD '<emphasis xmlns="http://docbook.org/ns/docbook" role="strong">SHOULD</emphasis>'>
        <!ENTITY MUST   '<emphasis xmlns="http://docbook.org/ns/docbook" role="strong">MUST</emphasis>'>
        <!ENTITY MUST_NOT   '<emphasis xmlns="http://docbook.org/ns/docbook" role="strong">MUST NOT</emphasis>'>
        
        <!-- changing authentication endpoints; define entities for US & UK rather than maintaining in text -->
        <!ENTITY ENDPOINT-US "https://identity.api.rackspacecloud.com/v1.1/">
        <!ENTITY ENDPOINT-UK "https://lon.identity.api.rackspacecloud.com/v1.1/">
        <!ENTITY ENDPOINT-US-20 "https://identity.api.rackspacecloud.com/v2.0/">
        <!ENTITY ENDPOINT-UK-20 "https://lon.identity.api.rackspacecloud.com/v2.0/">
]>

<book version="5.0"
         xmlns="http://docbook.org/ns/docbook"
         xmlns:xlink="http://www.w3.org/1999/xlink"
         xmlns:xi="http://www.w3.org/2001/XInclude"
         xmlns:svg="http://www.w3.org/2000/svg"
         xmlns:m="http://www.w3.org/1998/Math/MathML"
         xmlns:html="http://www.w3.org/1999/xhtml"
         xml:id="clb-getting-started">
    <?rax title.font.size="35px" subtitle.font.size="20px"?>
    <title>Rackspace Cloud Load Balancers Getting Started Guide</title>
    <titleabbrev>Rackspace Cloud LB and Servers Getting Started Guide</titleabbrev>

    <info>       
        <copyright>
            <year>2011</year>
            <year>2012</year>
            <year>2013</year>
            <holder>Rackspace US, Inc.</holder>
        </copyright>
        <releaseinfo>API v1.0</releaseinfo>
        <productname>Rackspace Cloud Load Balancers</productname>
        <pubdate>2013-02-05</pubdate>
        <legalnotice role="rs-api">
            <annotation>
                <remark>Copyright details are filled in by the template.</remark>
            </annotation>
        </legalnotice>
        <revhistory>
            <revision>
                <date>2013-02-05</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Corrected cURL Create Load Balancer
                                Request: XML example (refer to <xref
                                   linkend="Create_Load_Balancer"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-10-25</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Updated auth response examples
                                (refer to <xref
                                   linkend="Generating_Auth_Token"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-10-09</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Added information for pricing and
                                service level (refer to <xref
                                   linkend="Pricing_SLA-d1e1362"
                                />).</para>
                        </listitem>
                        <listitem>
                            <para>Updated information for cURL
                                command-line options (see <xref
                                   linkend="DB_using-curl-cli"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-08-02</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Corrected request examples for
                                authentication (refer to <xref
                                   linkend="Generating_Auth_Token"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-07-17</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Updated for Auth 2.0 (refer to <xref
                                   linkend="Generating_Auth_Token"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-06-13</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Added link to <citetitle>Cloud Load
                                   Balancers Developer
                                   Guide</citetitle>  (see <xref
                                   linkend="DB_Overview"/>).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-06-06</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Updated service catalog information
                                for authentication (see <xref
                                   linkend="Generating_Auth_Token"
                                />).</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>
            <revision>
                <date>2012-03-07</date>
                <revdescription>
                    <itemizedlist spacing="compact">
                        <listitem>
                            <para>Initial Release.</para>
                        </listitem>
                    </itemizedlist>
                </revdescription>
            </revision>           
        </revhistory>
    <raxm:metadata xmlns:raxm="http://docs.rackspace.com/api/metadata">
      <raxm:displayname>Getting Started Guide</raxm:displayname>
      <raxm:product version="v1.0">loadbalancers</raxm:product>
      <raxm:priority>10</raxm:priority>
    </raxm:metadata> 
    </info>
    <chapter xml:id="DB_Doc_Change_History">
        <title>Document Change History</title>
        <para>This version of the Getting Started replaces and
            obsoletes all previous versions. The most recent changes
            are described in the table below:</para>
        <?rax revhistory?>
    </chapter>
    <chapter xml:id="DB_Overview">
        <title>Overview</title>
        <para>Follow the steps described in this guide to use the
            Rackspace Cloud Load Balancers API and the Cloud
            Servers<trademark/> section of the Control Panel to create
            a load balancer configuration to balance traffic for your
            Rackspace Cloud Servers.</para>
        <para>For details about using the Cloud Load Balancers API,
            refer to the <citetitle>Cloud Load Balancers Developer
                Guide</citetitle> at <link
                xlink:href="http://docs.rackspace.com/">
                http://docs.rackspace.com/</link>.</para>
        <para>For more details about the Rackspace Cloud Load
            Balancers service, refer to <link
                xlink:href="http://www.rackspace.com/cloud/cloud_hosting_products/loadbalancers/"
                >http://www.rackspace.com/cloud/cloud_hosting_products/loadbalancers/</link>.This
            site also offers links to Rackspace's official support
            channels, including knowledge base articles, forums,
            phone, chat, and email.</para>
        <section xml:id="Prerequisites_Examples">
            <title>Prerequisites for Running Examples</title>
            <para>In order to run the examples in this guide, you must
                have the following prerequisites: <itemizedlist
                    spacing="compact">
                    <listitem>
                        <para>Rackspace Cloud account</para>
                    </listitem>
                    <listitem>
                        <para>Rackspace Cloud username and password,
                            as specified during registration</para>
                    </listitem>
                </itemizedlist></para>
        </section>
        <section xml:id="Pricing_SLA-d1e1362">
            <title>Pricing and Service Level</title>
            <para>Cloud Load Balancers is part of the Rackspace Cloud
                and your use through the API will be billed as per the
                pricing schedule at <link
                    xlink:href="http://www.rackspace.com/cloud/public/loadbalancers/pricing/"
                    >http://www.rackspace.com/cloud/public/loadbalancers/pricing/</link>.
                Cloud Servers is also part of the Rackspace Cloud and
                your use through the Control Panel will be billed as
                per the pricing schedule at <link
                    xlink:href="http://www.rackspace.com/cloud/public/servers/pricing/"
                    >http://www.rackspace.com/cloud/public/servers/pricing/</link>.</para>
            <para>The Service Level Agreements (SLAs) for Cloud Load
                Balancers and Cloud Servers are available at <link
                    xlink:href="http://www.rackspace.com/cloud/legal/sla/#cloud_load_balancers"
                    >http://www.rackspace.com/cloud/legal/sla/#cloud_load_balancers</link>
                and <link
                    xlink:href="http://www.rackspace.com/cloud/legal/sla/"
                    >http://www.rackspace.com/cloud/legal/sla/</link>
                respectively.</para>
        </section>
    </chapter>
    <chapter xml:id="Create_Cloud_Server">
        <title>Create a New Cloud Server</title>
        <para>In this chapter you will create two new Cloud Servers
            (or use two existing Cloud Servers) to set up as nodes for
            your load balancer.</para>
        <note>
            <para>If you are using existing Cloud Servers on your
                account, skip Steps 1-5 and go directly to Step 6
                below.</para>
        </note>
        <para>Create a Cloud Server using the Cloud Servers section of
            the Cloud Control Panel (login here: <link
                xlink:href="http://mycloud.rackspace.com/">Control
                Panel Login</link>).</para>
        <note>
            <para>You can also create a Cloud Server using the Cloud
                Servers API. Refer to the <citetitle><link
                    xlink:href="http://docs.rackspace.com/">Cloud
                    Servers API Developer Guide</link></citetitle> for
                details.</para>
        </note>
        <procedure>
            <title>To create a Cloud Server using the Cloud Control
                Panel:</title>
            <step>
                <para>Click <guimenuitem>Servers</guimenuitem> to view
                    the Cloud Servers page.</para>
            </step>
            <step>
                <para> Using the <guimenu>Region</guimenu> drop-down
                    menu, select the appropriate region, depending on
                    whether you want to create a first generation
                    Cloud Server or a next generation Cloud Server.
                    (The type of Cloud Server does not matter for this
                    exercise.)</para>
            </step>
            <step>
                <para> Select an image from a list of different
                    operating systems, including Linux Distributions
                    and Windows Images:</para>
                <para><inlinemediaobject>
                        <imageobject>
                            <imagedata
                                fileref="images/Choose_CS_Image_CCP.png"
                                contentwidth="6in"/>
                        </imageobject>
                    </inlinemediaobject></para>
            </step>
            <step>
                <para> Specify the <guilabel>Server Name</guilabel>
                    and select a <guilabel>Size</guilabel> for your
                    Cloud Server, then click <guibutton>Create
                        Server</guibutton>. </para>
            </step>
            <step>
                <para> Create a second Cloud Server by performing
                    Steps 1-4 again.</para>
            </step>
            <step>
                <para>Record the IP addresses of your Cloud Servers
                    below (from the information displayed in the Cloud
                    Servers section of the Cloud Control Panel):<itemizedlist>
                        <listitem>
                            <para>FIRST Cloud Server IP Address =
                                _______________________________________
                            </para>
                        </listitem>
                        <listitem>
                            <para>SECOND Cloud Server IP Address =
                                _______________________________________</para>
                        </listitem>
                    </itemizedlist></para>
            </step>
        </procedure>
    </chapter>
    <chapter xml:id="DB_Sending_API_Requests">
        <title>Send Requests to the API</title>
        <para>You have several options for sending requests through an
            API: </para>
        <itemizedlist spacing="compact">
            <listitem>
                <para>Developers and testers may prefer to use cURL,
                    the command-line tool from <link
                        xlink:href="http://curl.haxx.se/"
                        >http://curl.haxx.se/</link>. </para>
                <para>With cURL you can send HTTP requests and receive
                    responses back from the command line. </para>
            </listitem>
            <listitem>
                <para>If you like to use a more graphical interface,
                    the ReST client for Firefox also works well for
                    testing and trying out commands, see <link
                        xlink:href="https://addons.mozilla.org/en-US/firefox/addon/restclient/"
                        >https://addons.mozilla.org/en-US/firefox/addon/restclient/</link>. </para>
            </listitem>
            <listitem>
                <para>You can also download and install rest-client, a
                    Java application to test ReSTful web services,
                    from <link
                        xlink:href="http://code.google.com/p/rest-client/"
                        >http://code.google.com/p/rest-client/</link>. </para>
            </listitem>
        </itemizedlist>
        <section xml:id="DB_using-curl-cli">
            <title>Send API Requests Using cURL</title>
            <para>cURL is a command-line tool that is available on
                most UNIX®-like environments and Mac OS X® and can be
                downloaded for Windows® in order to interact with the
                ReST interfaces. For more information on cURL, visit
                    <link xlink:href="http://curl.haxx.se/"
                    >http://curl.haxx.se/</link>. </para>
            <para>cURL allows you to transmit and receive HTTP requests and responses from the
                command-line or from within a shell script. This makes it possible to work with the ReST API
                directly without using one of the client APIs. </para>
            <para>The following cURL command-line options will be used
                in this guide to run the examples:</para>
            <variablelist>
                <title>cURL Command-Line Options</title>
                <varlistentry>
                    <term><option>-d</option></term>
                    <listitem>
                        <para>Sends the specified data in a POST
                            request to the HTTP server.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><option>-i</option></term>
                    <listitem>
                        <para>Includes the HTTP header in the
                            output.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><option>-H HEADER</option></term>
                    <listitem>
                        <para>Specifies an HTTP header in the
                            request.</para>
                    </listitem>
                </varlistentry>
                <varlistentry>
                    <term><option>-X</option></term>
                    <listitem>
                        <para>Specifies the request method to use when
                            communicating with the HTTP server. The
                            specified request is used instead of the
                            default method, which is GET. For example,
                                <option>-X PUT</option> specifies to
                            use the PUT request method.</para>
                    </listitem>
                </varlistentry>
            </variablelist>
            <note>
                <para>If you have the tools, you can run the cURL JSON
                    request examples with the following options to
                    format the output from cURL: <command>&lt;curl
                        JSON request example> | python
                        -mjson.tool</command>.</para>
            </note>
        </section>
        <section xml:id="DB_copy_paste_examples">
            <title>Copying and Pasting cURL Request Examples into a
                Terminal Window</title>
            <para>To run the cURL request examples shown in this guide
                on Linux or Mac systems, copy and paste each example
                from the HTML version of this guide into an ASCII
                editor (for example <emphasis role="bold"
                    >vi</emphasis> or <emphasis role="bold"
                    >TextEdit</emphasis>). Then modify each example
                with your required account information and so forth,
                as detailed in this guide.</para>
            <note>
                <para>The carriage returns in the cURL request
                    examples that are part of the cURL syntax are
                    escaped with a backslash ('\') in order to avoid
                    prematurely terminating the command. However you
                    should not escape carriage returns inside the xml
                    or json message within the command.</para>
            </note>
            <para>Consider the following cURL Authenticate Request:
                XML example that is described in detail in <xref
                    linkend="Generating_Auth_Token"/>:</para>
            <example>
                <title>cURL Authenticate Request: XML</title>
                <?dbfo keep-together="always"?>
                <screen language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'&lt;?xml version="1.0" encoding="UTF-8"?>  
 &lt;auth&gt;   
    &lt;apiKeyCredentials     
        xmlns="http://docs.rackspace.com/identity/api/ext/RAX-KSKEY/v1.0"     
        username="<emphasis role="bold">your_username</emphasis>"     
        apiKey="<emphasis role="bold">your_api_key</emphasis>"/&gt;   
 &lt;/auth&gt;<option>'</option> \
<uri>'https://identity.api.rackspacecloud.com/v2.0/tokens'</uri></screen>
            </example>
            <para>You can see that the lines that are part of the cURL
                command syntax have all been escaped with a backslash
                ('\') to indicate that the command continues on the
                next line:</para>
            <screen language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
  
   
(... lines within the xml portion of the message are not shown in this example)
(... the example only shows lines that are part of cURL syntax)     
     
    
   
 &lt;/auth&gt;<option>'</option> \
<uri>'https://identity.api.rackspacecloud.com/v2.0/tokens'</uri></screen>
            <para>However the lines <emphasis>within</emphasis> the
                xml portion of the message are
                    <emphasis>not</emphasis> escaped with a backslash
                ('\') in order to avoid issues with the xml
                processing:</para>
            <screen language="bash">'&lt;?xml version="1.0" encoding="UTF-8"?>  
 &lt;auth&gt;   
    &lt;apiKeyCredentials     
        xmlns="http://docs.rackspace.com/identity/api/ext/RAX-KSKEY/v1.0"     
        username="<emphasis role="bold">your_username</emphasis>"     
        apiKey="<emphasis role="bold">your_api_key</emphasis>"/&gt;   
 &lt;/auth&gt;<option>'</option> \
</screen>
            <note>
                <para>The final line of the xml message is escaped
                    since the backslash lies
                        <emphasis>outside</emphasis> the xml message
                    and continues the cURL command to the next
                    line.</para>
            </note>
            <para>After you are finished modifying the text for the
                cURL request example with your information (for
                example <emphasis role="bold"
                        ><code>your_username</code></emphasis> and
                    <emphasis role="bold"
                    ><code>your_api_key</code></emphasis>), paste it
                into your terminal window. Then execute the cURL
                command by pressing <guilabel>Enter</guilabel>.</para>
            <para>If you have trouble copying and pasting the examples
                as described, try typing the entire example on one
                long line, removing all the backslash line
                continuation characters.</para>
        </section>
    </chapter>
    <chapter xml:id="Generating_Auth_Token">
        <title>Generate an Authentication Token</title>
        <para>You need to generate a token whether you use cURL or a
            ReST client.</para>
        
        <para>In order to use the ReST API, you will first need to
            obtain an authentication token, which will need to be
            passed in for each request using the
                <code>X-Auth-Token</code> header. </para>
        <para>The following example demonstrates how to use cURL to
            obtain the authentication token and the account number.
            You will need to supply the authentication token and
            account number when making subsequent Cloud Load Balancer
            API calls.</para>
        <para>Remember to replace the names in the Authenticate
            Request examples below with their respective values:<itemizedlist spacing="compact">
                <listitem>
                    <para><emphasis role="bold"
                            >your_username</emphasis> &mdash; The
                        username is your common Rackspace Cloud
                        username, as supplied during
                        registration.</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >your_api_key</emphasis> &mdash; The key
                        is your API access key. The key can be
                        obtained from the Rackspace Cloud Control
                        Panel in the <guimenu>&lt;Your
                            Account></guimenu> / <guimenuitem>API
                            Access</guimenuitem> section (login here:
                            <link
                            xlink:href="http://mycloud.rackspace.com/"
                            >Control Panel Login</link>).</para>
                </listitem>
            </itemizedlist></para>
        <para> To access the Authentication Service, you must know
            whether your account is US-based or UK-based: </para>
        <itemizedlist spacing="compact">
            <listitem>
                <para> US-based accounts authenticate through <link
                        xlink:href="&ENDPOINT-US-20;"
                        >&ENDPOINT-US-20;</link>. </para>
            </listitem>
            <listitem>
                <para> UK-based accounts authenticate through <link
                        xlink:href="&ENDPOINT-UK-20;"
                        >&ENDPOINT-UK-20;</link>. </para>
            </listitem>
        </itemizedlist>
        <para> Your account may be based in either the US or the UK;
            this is not determined by your physical location but by
            the location of the Rackspace retail site which was used
            to create your account: </para>
        <itemizedlist spacing="compact">
            <listitem>
                <para> If your account was created via <link
                        xlink:href="http://www.rackspacecloud.com"
                        >http://www.rackspacecloud.com</link>, it is a
                    US-based account. </para>
            </listitem>
            <listitem>
                <para> If your account was created via <link
                        xlink:href="http://www.rackspace.co.uk"
                        >http://www.rackspace.co.uk</link>, it is a
                    UK-based account. </para>
            </listitem>
        </itemizedlist>
        <para> If you are unsure how your account was created, use the
            Rackspace contact information at either site to ask for
            help. </para>
        <para>Notice that you authenticate using a special URL for
            Cloud authentication services
                (<code>https://identity.api.rackspacecloud.com/v2.0/tokens</code>),
            as shown in the following Authenticate Request examples.
            Note that the <code>v2.0</code> component in the URL
            indicates that you are using version 2.0 of the Cloud Auth
            API.</para>
        <example>
            <title>cURL Authenticate Request: XML</title>
            <?dbfo keep-together="always"?>
            <screen language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'&lt;?xml version="1.0" encoding="UTF-8"?>  
&lt;auth>
   &lt;apiKeyCredentials
      xmlns="http://docs.rackspace.com/identity/api/ext/RAX-KSKEY/v1.0"
         username="<emphasis role="bold">your_username</emphasis>" 
         apiKey="<emphasis role="bold">your_api_key</emphasis>"/>
&lt;/auth>' \
<option>-H 'Content-Type: application/xml'</option> \
<option>-H 'Accept: application/xml'</option> \
<uri>'https://identity.api.rackspacecloud.com/v2.0/tokens'</uri></screen>
        </example>
        <example>
            <title>cURL Authenticate Request: JSON</title>
            <?dbfo keep-together="always"?>
            <screen language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'{
    "auth":
    {
       "RAX-KSKEY:apiKeyCredentials":
       {  
          "username": "<emphasis role="bold">your_username</emphasis>",  
          "apiKey": "<emphasis role="bold">your_api_key</emphasis>"}
    }  
}' \
<option>-H 'Content-Type: application/json'</option> \
<uri>'https://identity.api.rackspacecloud.com/v2.0/tokens'</uri></screen>
        </example>
        <example>
            <title>Authenticate Response: XML</title>
            <programlisting language="xml"><xi:include href="../../src/resources/samples/auth-20.xml" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
        <example>
            <title>Authenticate Response: JSON</title>
            <programlisting language="json"><xi:include href="../../src/resources/samples/auth-20.json" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
        <para>The authentication token <code>id</code> is returned
            along with an <code>expires</code> attribute that
            specifies when the token expires. </para>
        <note>
            <title>Notes</title>
            <itemizedlist spacing="compact">
                <listitem>
                    <para>For all response examples in this guide, the
                        field values you receive in your responses
                        will vary from those shown here since they
                        will be specific to your account.</para>
                </listitem>
                <listitem>
                    <para>The <code>id</code> attribute in the
                        Authenticate Response specifies the
                        authentication token. Tokens are valid for a
                        finite duration.</para>
                    <para>Remember to supply your authentication token
                        wherever you see the field <emphasis
                            role="bold">your_auth_token</emphasis> in
                        the examples in this guide.</para>
                </listitem>
                <listitem>
                    <para> The <code>expires</code> attribute denotes
                        the time after which the token will
                        automatically become invalid. A token may be
                        manually revoked before the time identified by
                        the expires attribute; <code>expires</code>
                        predicts a token's maximum possible lifespan
                        but does not guarantee that it will reach that
                        lifespan. Clients are encouraged to cache a
                        token until it expires.</para>
                </listitem>
                <listitem>
                    <para>Applications should be designed to
                        re-authenticate after receiving a 401
                        (Unauthorized) response from a service
                        endpoint.</para>
                </listitem>
            </itemizedlist>
        </note>
        <para>The <code>publicURL</code> endpoints for the services
            (for example
                <code>https://servers.api.rackspacecloud.com/v1.0/1100111</code>)
            are also returned in the response.</para>
        <para>You will find the actual account number after the final
            '/' in the <code>publicURL</code> field. In this example,
            you can see that the account number is 1100111. You need
            to specify your account number on most of the Cloud Load
            Balancers API calls, wherever you see the field <emphasis
                role="bold">your_acct_id</emphasis> specified in the
            examples in this guide.</para>
        <para>Load balancer service endpoints are published in the
            service catalog in the Auth response with the account
            number, which is a required element of the service
            endpoints. The examples shown here are for authentication
            for US customers. Customers with UK-based accounts will
            see different values in the service catalog. Refer to
                <xref linkend="Service_Access_Endpoints-d1e753"/> for
            more information about service endpoints. </para>
        <para>After authentication, you can use cURL to perform &GET;,
            &DELETE;, &PUT;,  and &POST; requests for the Cloud Load
            Balancer API.</para>
        
    </chapter>
    <chapter xml:id="Service_Access_Endpoints-d1e753">
        <title>Service Access/Endpoints</title>
        <para>Specify a region to operate against by selecting an
            endpoint from the table below to use for your Cloud Load
            Balancer API calls.</para>
        <para>
            <table rules="all">
                <?dbfo keep-together="always"?>
                <caption>Regionalized Service Endpoints</caption>
                <thead>
                    <tr align="center">
                        <td colspan="1">Region</td>
                        <td colspan="4">Endpoint</td>
                    </tr>
                </thead>
                <tbody>
                    <tr align="left">
                        <td colspan="1">Chicago (ORD)</td>
                        <td colspan="4">
                            <code>https://ord.loadbalancers.api.rackspacecloud.com/v1.0/</code><parameter>1234</parameter>/ </td>
                    </tr>
                    <tr align="left">
                        <td colspan="1">Dallas/Ft. Worth (DFW) </td>
                        <td colspan="4">
                            <code>https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</code><parameter>1234</parameter>/ </td>
                    </tr>
                    <tr align="left">
                        <td colspan="1">London (LON)</td>
                        <td colspan="4">
                            <code>https://lon.loadbalancers.api.rackspacecloud.com/v1.0/</code><parameter>1234</parameter>/ </td>
                    </tr>
                </tbody>
            </table>
        </para>
        <para>
            <emphasis role="bold">Since you are load balancing Cloud
                Servers</emphasis> in this guide, you can determine
            the appropriate endpoint to select by viewing your Cloud
            Servers list and creating a load balancer within the same
            region as the datacenter in which your Cloud Server
            resides. When your resources reside in the same region as
            your load balancer, devices are in close proximity to each
            other and can take advantage of ServiceNet connectivity
            for free data transfer between services. </para>
        <note>
            <para>All examples in this guide assume that you are
                operating against the DFW datacenter, however if you
                are using a different datacenter, be sure to use the
                associated endpoint from the table above
                instead.</para>
        </note>
        <para>Replace the sample account ID number,
                <parameter>1234</parameter>, with your actual account
            number returned as part of the authentication response.
            Use your actual account number wherever you see the field
                <emphasis role="bold">your_acct_id</emphasis>
            specified in this guide. Refer to <xref
                linkend="Generating_Auth_Token"/>.</para>
        <para>When making a Cloud Load Balancers API call, place the
            endpoint at the beginning of the request URL, for example:
            (<code>https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</code><emphasis role="bold">your_acct_id</emphasis><code>/</code>),
            as you can see in the cURL Create Load Balancer Request
            examples in <xref linkend="Create_Load_Balancer"/>. Note
            that the <code>v1.0</code> component in the URL indicates
            that you are using version 1.0 of the Cloud Load Balancers
            API.</para>
    </chapter>
    <chapter xml:id="Create_Load_Balancer">
        <title>Create a Load Balancer</title>
        <para> Cloud Load Balancers make it easy to develop scalable,
            high-availability configurations in the Cloud. By
            leveraging Cloud Load Balancers, you will be provided with
            a dedicated IP address that you can use to reach your
            service.</para>
        <para>You need to use the Create Load Balancer API call
                (<code>/loadbalancers</code>) to create a load
            balancer with the configuration that you specify.</para>
        <para>In this case, assume that you want to create a load
            balancer with the following configuration:</para>
        <itemizedlist>
            <listitem>
                <para>Protocol = HTTP(80)</para>
            </listitem>
            <listitem>
                <para>Virtual IP Type = PUBLIC</para>
                <note>
                    <para>When your resources reside in the same
                        region as your load balancer, devices are in
                        close proximity to each other and can elect to
                        take advantage of ServiceNet connectivity (by
                        specifying Virtual IP Type = SERVICENET) for
                        free data transfer between services if
                        desired.</para>
                </note>
            </listitem>
            <listitem>
                <para>Nodes = &lt;enter the IP address that you
                    recorded for your first Cloud Server created in
                        <xref linkend="Create_Cloud_Server"/>:</para>
                <itemizedlist>
                    <listitem>
                        <para><code>&lt;node address="</code><emphasis role="bold">&lt;IP
                            address of FIRST cloud server></emphasis><code>"
                                port="80" condition="ENABLED"/></code><note>
                                <para>Although you could add the nodes
                                   for both of your Cloud Servers in
                                   this Create Load Balancer call, you
                                   will instead add the node for your
                                   second Cloud Server using the
                                   separate Add Node call in <xref
                                   linkend="Add_Node"/>.</para>
                            </note></para>
                    </listitem>
                </itemizedlist>
            </listitem>
        </itemizedlist>
        <para>The following examples show the cURL requests for Create
            Load Balancer:</para>
        <example>
            <title>cURL Create Load Balancer Request: XML</title>
            <programlisting language="bash"><command>curl -i -d</command> \
'&lt;?xml version="1.0" ?> 
&lt;loadBalancer xmlns="http://docs.openstack.org/loadbalancers/api/v1.0"
    name="a-new-loadbalancer"
    port="80"
    protocol="HTTP">
    &lt;virtualIps>
        &lt;virtualIp type="PUBLIC"/>
    &lt;/virtualIps>
    &lt;nodes>
        &lt;node address=<emphasis role="bold">"&lt;IP address of FIRST cloud server>"</emphasis> port="80" condition="ENABLED"/> 
    &lt;/nodes>
&lt;/loadBalancer>' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/xml'</option> \
<option>-H 'Accept: application/xml'</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers'</uri></programlisting>
        </example>
        <example>
            <title>cURL Create Load Balancer Request: JSON</title>
            <programlisting language="bash"><command>curl -i -d</command> \
'{
    "loadBalancer": {
        "name": "a-new-loadbalancer",
        "port": 80,
        "protocol": "HTTP",
        "virtualIps": [
            {
                "type": "PUBLIC"
            }
         ],
        "nodes": [
            {
                "address": "<emphasis role="bold">&lt;IP address of FIRST cloud server></emphasis>",
                "port": 80,
                "condition": "ENABLED"
            }
        ]
    }
}' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/json'</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers'</uri></programlisting>
        </example>
        <para>Remember to replace the names in the examples above with
            their actual respective values for all the cURL examples
            that follow:<itemizedlist spacing="compact">
                <listitem>
                    <para><emphasis role="bold"
                        >your_auth_token</emphasis> &mdash; as returned in your
                        authentication response (see the response
                        examples in <xref
                            linkend="Generating_Auth_Token"/>)</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >your_acct_id</emphasis> &mdash; as
                        returned in your authentication response (must
                        be replaced in the request URL)</para>
                </listitem>
            </itemizedlist></para>
        <para>The following examples show the responses for Create
            Load Balancer:</para>
        <example>
            <title>Create Load Balancer Response: XML</title>
            <programlisting language="xml"><xi:include href="../../src/resources/samples/lb-gs-create-required-response.xml" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
        <example>
            <title>cURL Create Load Balancer  Response: JSON</title>
            <programlisting language="json"><xi:include href="../../src/resources/samples/lb-gs-create-required-response.json" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
        <para>In the previous examples, you can see that one node
            (with IP address "50.56.166.100") has been added to your
            new load balancer with id 5355. You will need the load
            balancer id for making the List Load Balancer Details call
            in the next section, and you should supply this value
            wherever you see the field <emphasis role="bold"
                >load_balancer_id</emphasis> in the examples in this
            guide.</para>
    </chapter>
    
    <chapter xml:id="List_LB_Details">
            <title>List Load Balancer Details</title>
            <para>This operation provides detailed output for a
            specific load balancer configured and associated with your
            account. This operation is not capable of returning
            details for a load balancer which has been deleted. </para>
        <para>This operation does not require a request body. </para>
        <para>The examples list the details for the load balancer
            (with <emphasis role="bold">load_balancer_id</emphasis>,
            which you will need to replace in the URL in the example
            below) that you created in the previous section.</para>
        <para>The following examples show the cURL requests for List
            Load Balancer Details:</para>
        <example>
            <title>cURL List Load Balancer Details Request:
                XML</title>
            <programlisting language="bash"><command>curl</command> <option>-i</option>  \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>'  \
<option>-H 'Accept: application/xml'</option>  \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>'</uri></programlisting>
        </example>
        <example>
            <title>cURL List Load Balancer Details Request:
                JSON</title>
            <programlisting language="bash"><command>curl</command> <option>-i</option>  \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>'  \
<option>-H 'Accept: application/json'</option>  \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>'</uri></programlisting>
        </example>
        <para>Remember to replace the names in the examples above with
            their actual respective values for all the cURL examples
            that follow:<itemizedlist spacing="compact">
                <listitem>
                    <para><emphasis role="bold"
                            >your_auth_token</emphasis> &mdash; as
                        returned in your authentication response (see
                        the response examples in <xref
                            linkend="Generating_Auth_Token"/>)</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >your_acct_id</emphasis> &mdash; as
                        returned in your authentication response (must
                        be replaced in the request URL)</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >load_balancer_id</emphasis> &mdash; as
                        returned in your create load balancer response
                        (must be replaced in the request URL)</para>
                </listitem>
            </itemizedlist></para>
        <para>The following examples show the List Load Balancer
            Details responses:</para>
            
            <example>
                <title>List Load Balancer Details Response:
                XML</title>
                <programlisting language="xml"><xi:include href="../../src/resources/samples/lb-gs-list-details-response.xml" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
            </example>
            
            <example>
                <title>List Load Balancer Details Response:
                JSON</title>
                <programlisting language="json"><xi:include href="../../src/resources/samples/lb-gs-list-details-response.json" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
            </example>
        </chapter>
    <chapter xml:id="Add_Node">
        <title>Add Node</title>
        <para>When a node is added to a load balancer, it is assigned
            a unique identifier that can be used for management
            operations such as changing the condition or removing
            it.</para>
        <para>For the node, enter the IP address that you recorded for
            your second Cloud Server created in <xref
                linkend="Create_Cloud_Server"/>. For example, for the
            XML request, enter:</para>
        <itemizedlist>
            <listitem>
                <para><code>&lt;node address="</code><emphasis
                        role="bold">&lt;IP address of SECOND cloud
                        server></emphasis><code>" port="80"
                        condition="ENABLED"/></code></para>
            </listitem>
        </itemizedlist>
        <para xmlns="http://docbook.org/ns/docbook">The following
            examples show the cURL requests for Add Node:</para>
        <example>
            <title>cURL Add Node Request: XML</title>
            <programlisting language="bash"><command>curl</command><option>-i</option> <option>-d</option> \
'&lt;?xml version="1.0" ?> 
&lt;nodes xmlns="http://docs.openstack.org/loadbalancers/api/v1.0">
    &lt;node address="<emphasis role="bold">&lt;IP address of SECOND cloud server></emphasis>" port="80" condition="ENABLED" />
&lt;/nodes>' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/xml'</option> \
<option>-H 'Accept: application/xml'</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>/nodes'</uri></programlisting>
        </example>
        <example>
            <?dbfo keep-together="always"?>
            <title>cURL Add Node Request: JSON</title>
            <programlisting language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'{
    "nodes": [
        {
            "address": "&lt;<emphasis role="bold">IP address of SECOND cloud server</emphasis>>",
            "port": 80,
            "condition": "ENABLED"
        }
    ]
}' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/json'</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>/nodes'</uri></programlisting>
        </example>
        <para>Remember to replace the names in the examples above with
            their actual respective values:<itemizedlist spacing="compact">
                <listitem>
                    <para><emphasis role="bold"
                            >your_auth_token</emphasis> &mdash; as
                        returned in your authentication response (see
                        the examples in <xref
                            linkend="Generating_Auth_Token"/>)</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >your_acct_id</emphasis> &mdash; as
                        returned in your authentication response (see
                        the examples in <xref
                            linkend="Generating_Auth_Token"/>)</para>
                </listitem>
                <listitem>
                    <para><emphasis role="bold"
                            >load_balancer_id</emphasis> &mdash; as
                        returned in your create load balancer response
                        (see the examples in <xref
                            linkend="Create_Load_Balancer"/>)</para>
                </listitem>
            </itemizedlist></para>
        <para>The following examples show the responses for Add
            Node:</para>
        <example>
            <title>Add Node Response: XML</title>
            <programlisting language="xml"><xi:include href="../../src/resources/samples/lb-gs-add-nodes-response.xml" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
        <example>
            <title>Add Node Response: JSON</title>
            <programlisting language="json"><xi:include href="../../src/resources/samples/lb-gs-add-nodes-response.json" parse="text"><xi:fallback>Missing code sample! <?rax fail?></xi:fallback></xi:include></programlisting>
        </example>
    </chapter>
    <chapter xml:id="Configure_Load_Balancer">
        <title>Update Load Balancer Attributes</title>
        <para>Assume that you want to change the algorithm for your
            load balancer from RANDOM to LEAST_CONNECTIONS. You can
            use the Update Load Balancer Attributes API call to
            accomplish this task. This call allows you to change one
            or more of the following load balancer attributes:
            <itemizedlist spacing="compact">
                <listitem>
                    <para>name</para>
                </listitem>
                <listitem>
                    <para>algorithm</para>
                </listitem>
                <listitem>
                    <para>protocol</para>
                </listitem>
                <listitem>
                    <para>port</para>
                </listitem>
            </itemizedlist></para>
        <para>The following examples show the cURL requests for Update
            Load Balancer Attributes to change the algorithm to
            LEAST_CONNECTIONS:</para>
        <example>
            <title>cURL Update Load Balancer Attributes Request:
                XML</title>
            <programlisting language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'&lt;?xml version="1.0" ?>
&lt;loadBalancer xmlns="http://docs.openstack.org/loadbalancers/api/v1.0"
    algorithm="LEAST_CONNECTIONS" />' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/xml'</option> \
<option>-H 'Accept: application/xml'</option> \
<option>-X PUT</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>'</uri></programlisting>
        </example>
        <example>
            <title>cURL Update Load Balancer Attributes Request:
                JSON</title>
            <programlisting language="bash"><command>curl</command> <option>-i</option> <option>-d</option> \
'{"loadBalancer":{
    "algorithm": "LEAST_CONNECTIONS"
    }
}' \
-H 'X-Auth-Token: <emphasis role="bold">your_auth_token</emphasis>' \
<option>-H 'Content-Type: application/json'</option> \
<option>-X PUT</option> \
<uri>'https://dfw.loadbalancers.api.rackspacecloud.com/v1.0/</uri><emphasis role="bold">your_acct_id</emphasis><uri>/loadbalancers/</uri><emphasis role="bold">load_balancer_id</emphasis><uri>'</uri></programlisting>
        </example>
        <para>This operation does not return a response body.</para>
        <para>You can now confirm that the algorithm is changed by
            calling List Load Balancer Details, as described in <xref
                linkend="List_LB_Details"/>.</para>
        <para>You can also view the information for the load balancer
            you have created by clicking <guilabel>Load
                Balancers</guilabel> in the <guimenu>Hosting</guimenu>
            section of the Control Panel. Then click the name of the
            load balancer to view the details.</para>
        <para>This concludes the <citetitle>Getting
                Started</citetitle>. Thank you for using Rackspace
            Cloud products.</para>
    </chapter>
</book>
